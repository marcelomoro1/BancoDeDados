CREATE DATABASE IF NOT EXISTS EMPRESA;
DROP DATABASE EMPRESA;
CREATE TABLE EMPRESA.FUNCIONARIO (
	Pnome VARCHAR(50) NOT NULL,
    Minicial CHAR,
    Unome VARCHAR(15) NOT NULL,
    Cpf CHAR(11) PRIMARY KEY,
    DataNascimento DATE NOT NULL,
    Endereco VARCHAR(255) NOT NULL,
    Sexo CHAR NOT NULL,
    Cpf_supervisor CHAR(11),
	Dnr INT,
    Salario DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (Cpf_supervisor) REFERENCES FUNCIONARIO(Cpf)
);

DESC EMPRESA.FUNCIONARIO;  #Descrição da tabela

CREATE TABLE EMPRESA.DEPARTAMENTO(
	Dnome VARCHAR(20) NOT NULL UNIQUE,
    Dnumero INT PRIMARY KEY,
    Cpf_gerente CHAR(11),
    Data_inicio_gerente DATE,
    FOREIGN KEY (Cpf_gerente) REFERENCES FUNCIONARIO(Cpf_supervisor)
);

DESC EMPRESA.DEPARTAMENTO;

ALTER TABLE	EMPRESA.FUNCIONARIO
ADD FOREIGN KEY (Dnr) REFERENCES DEPARTAMENTO(Dnumero);

CREATE TABLE EMPRESA.LOCALIZACAO(
	Dnumero INT NOT NULL,
    Dlocal VARCHAR(15) NOT NULL,
    PRIMARY KEY (Dnumero, Dlocal),
    FOREIGN KEY (Dnumero) REFERENCES DEPARTAMENTO(Dnumero)
);

CREATE TABLE EMPRESA.PROJETO(
	Projnome VARCHAR(15) NOT NULL UNIQUE,
    Projnumero INT PRIMARY KEY,
    Projlocal VARCHAR(15),
    Dnum INT,
    FOREIGN KEY (Dnum) references DEPARTAMENTO(Dnumero)
);

CREATE TABLE EMPRESA.TRABALHA_EM(
	Fcpf CHAR(11) NOT NULL,
    Pnr INT NOT NULL,
    PRIMARY KEY (Fcpf, Pnr),
    Horas DECIMAL (3,1) NOT NULL,
    FOREIGN KEY (Fcpf) REFERENCES FUNCIONARIO (Cpf),
    FOREIGN KEY (Pnr) REFERENCES PROJETO(Projnumero)
);

DESC EMPRESA.TRABALHA_EM;

USE EMPRESA;

CREATE TABLE DEPENDENTE(
	Fcpf CHAR(11) NOT NULL,
    Nome_dependente VARCHAR(15),
    Sexo CHAR, 
    Datanascimento DATE NOT NULL,
    Parentesco VARCHAR(8),
    PRIMARY KEY (Fcpf, Nome_dependente),
    FOREIGN KEY (Fcpf) REFERENCES FUNCIONARIO(Cpf)
);

ALTER TABLE FUNCIONARIO
	MODIFY COLUMN SALARIO DECIMAL(10,2) CHECK (SALARIO>0);

DESC FUNCIONARIO;

INSERT INTO DEPARTAMENTO (Dnome, Dnumero)
VALUES ('Pesquisa',5);

SELECT * FROM DEPARTAMENTO;

INSERT INTO DEPARTAMENTO (Dnome, Dnumero)
VALUES ('Administração',4);

INSERT INTO DEPARTAMENTO (Dnome, Dnumero)
VALUES ('Matriz',1);

DESC FUNCIONARIO;

INSERT INTO FUNCIONARIO (Pnome, Unome, Cpf, DataNascimento, Endereco, Sexo)
VALUES ('João','Silva','12345678999','1965-01-09','Rua das flores, patronato','M');

SELECT * FROM FUNCIONARIO;

INSERT INTO FUNCIONARIO (Pnome, Unome, Cpf, DataNascimento, Endereco, Sexo, Salario)
VALUES ('Fernando','Wong','51512512','1955-11-01','asdasdsasds, pdasdasdnato','M', 40.000);
